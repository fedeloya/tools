<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Responsive Split View (Centered) with Full Pan</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
      user-select: none;
      touch-action: none;
    }

    .container {
      position: relative;
      width: 100%;
      height: 100vh;
      cursor: ew-resize;
      overflow: hidden;
    }

    .layer {
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    .layer img {
      position: absolute;
      user-drag: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }

    /* Default: fit to height (mobile), horizontally centered */
    .layer img {
      height: 100%;
      width: auto;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
    }

    /* Desktop: fit to width, vertically centered */
    @media (min-width: 1280px) {
      .layer img {
        width: 100%;
        height: auto;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
      }
    }

    .design-layer {
      clip-path: inset(0 50% 0 0);
      z-index: 2;
    }

    .reality-layer {
      z-index: 1;
    }

    .slider {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 3px;
      background: white;
      left: 50%;
      transform: translateX(-1.5px);
      z-index: 3;
    }
  </style>
</head>
<body>

  <div class="container" id="sliderContainer">
    <div class="layer reality-layer" id="realityLayer">
      <img src="img/kitchen-real.png" alt="Reality" id="realityImg" />
    </div>
    <div class="layer design-layer" id="designLayer">
      <img src="img/kitchen-render.png" alt="Design" id="designImg" />
    </div>
    <div class="slider" id="slider"></div>
  </div>

  <script>
    const container = document.getElementById('sliderContainer');
    const slider = document.getElementById('slider');
    const designImg = document.getElementById('designImg');
    const realityImg = document.getElementById('realityImg');
    const designLayer = document.getElementById('designLayer');

    let splitPercentage = 50;
    let panOffset = 0;
    let isDragging = false;
    let dragMode = null;
    let startX = 0;

    function updateSplit() {
      designLayer.style.clipPath = `inset(0 ${100 - splitPercentage}% 0 0)`;
      slider.style.left = `${splitPercentage}%`;
    }

    function updatePan() {
      const isDesktop = window.innerWidth >= 1280;
      const imageWidth = getImageWidth(designImg);
      const containerWidth = container.clientWidth;

      const overflow = imageWidth > containerWidth ? imageWidth - containerWidth : 0;
      const halfOverflow = overflow / 2;

      const minPan = -halfOverflow;
      const maxPan = halfOverflow;

      // Clamp panOffset within allowed range
      panOffset = Math.min(maxPan, Math.max(minPan, panOffset));

      if (isDesktop) {
        // For desktop, image is vertically centered (translateY(-50%)) plus horizontal pan
        designImg.style.transform = `translateY(-50%) translateX(${panOffset}px)`;
        realityImg.style.transform = `translateY(-50%) translateX(${panOffset}px)`;
      } else {
        // For mobile, image is horizontally centered (translateX(-50%)) plus pan
        designImg.style.transform = `translateX(calc(-50% + ${panOffset}px))`;
        realityImg.style.transform = `translateX(calc(-50% + ${panOffset}px))`;
      }
    }

    function getClientX(e) {
      return e.touches ? e.touches[0].clientX : e.clientX;
    }

    function getImageWidth(img) {
      return img.getBoundingClientRect().width;
    }

    function startDrag(e) {
      const x = getClientX(e);
      const sliderRect = slider.getBoundingClientRect();
      const buffer = 20;

      if (x >= sliderRect.left - buffer && x <= sliderRect.right + buffer) {
        dragMode = 'split';
      } else {
        dragMode = 'pan';
      }

      startX = x;
      isDragging = true;

      // Prevent default to avoid unwanted text selection or scrolling
      e.preventDefault();
    }

    function moveDrag(e) {
      if (!isDragging) return;

      const x = getClientX(e);
      const deltaX = x - startX;
      startX = x;

      if (dragMode === 'split') {
        const rect = container.getBoundingClientRect();
        const offsetX = Math.max(0, Math.min(x - rect.left, rect.width));
        splitPercentage = (offsetX / rect.width) * 100;
        updateSplit();
      } else if (dragMode === 'pan') {
        const imageWidth = getImageWidth(designImg);
        const containerWidth = container.clientWidth;

        const overflow = imageWidth > containerWidth ? imageWidth - containerWidth : 0;
        const halfOverflow = overflow / 2;

        const minPan = -halfOverflow;
        const maxPan = halfOverflow;

        panOffset = Math.min(maxPan, Math.max(minPan, panOffset + deltaX));
        updatePan();
      }

      // Prevent scrolling on touch devices while dragging
      e.preventDefault();
    }

    function endDrag() {
      isDragging = false;
      dragMode = null;
    }

    container.addEventListener('mousedown', startDrag);
    container.addEventListener('mousemove', moveDrag);
    container.addEventListener('mouseup', endDrag);
    container.addEventListener('mouseleave', endDrag);

    container.addEventListener('touchstart', startDrag, { passive: false });
    container.addEventListener('touchmove', moveDrag, { passive: false });
    container.addEventListener('touchend', endDrag);
    container.addEventListener('touchcancel', endDrag);

    window.addEventListener('load', () => {
      updateSplit();
      updatePan();
    });

    window.addEventListener('resize', () => {
      updatePan();
    });
  </script>

</body>
</html>
